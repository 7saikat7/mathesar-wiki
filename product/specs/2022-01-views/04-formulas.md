---
title: 04. Formulas
description: A list of initial formulas supported in Views
published: true
date: 2022-02-22T00:11:20.709Z
tags: 
editor: markdown
dateCreated: 2022-02-04T03:33:53.715Z
---

> Under construction.
{.is-warning}

# Structure

Formulas have the following attributes:
- **Name**: A unique human-readable name
- **Description**: A description of what the formula does
- **Variables Accepted**: This is the list of variables needed for a formula to work. Variables have the following attributes:
    - **Name**: A unique name (within the formula)
    - **Description**: A description of how the variable fits into the formula
    - **Type**: The type of data accepted.
    - **Value**: The value that this variable is set to.
- **Data Editable?**: Whether data in cells generated by this formula is editable.
- **Data Type**: The data type of the column that applying this formula will result in.

## Variable Types
Variables can accept the following types of data:
- **Literal**: Literals are a static value, like a number of a string.
    - Literal variable types should include a list of DB [Data Types](/en/product/concepts/data-types) they accept.
- **Column Reference**: A reference to a column. This can be either from a table or a previous column that has been added to the query.
    - If there are multiple ways to get to the column (i.e. there are multiple relationships between the query's reference table and the column), then the column reference should also include the relationship to use.
    - Some formulas might be limited to column references of the following types:
        - Single related records
        - Multiple related records
            - Column references to multiple related records also accept filters, in case the column only needs to use a subset of the related records

## Categorizing Formulas
In order to make finding the right formula easier, we should categorize formulas by the type of variable they accept.
- For example, if the user is trying to add a formula to a `DATE` column, we would only show them the formulas that accept literal values of the `DATE` data type.
- When the user starts by adding a formula column, we can show the types of data a formula accepts to help them find the formula easier. See below for a _very_ rough representation of one way to do this.

![view_builder_4.png](/view_builder_4.png)

## Editing Formula Data
When a query is turned into a View, we will allow users to edit data from the View in some cases. Each formula that is editable will define its own editing behavior, but here are some general guidelines:
- Formulas that transform the original data don't result in editable data.
    - e.g. if we apply a "Extract Year" formula to a `DATE` column to transform, say, `2020-01-03` into `2020`, then the `2020` will not be editable.
    - e.g. if we apply a "Count Related" formula to count the number of genres a movie has, we will not be able to edit the count.
- Formulas that directly represent the original data _may_ be editable.
   - e.g. if we apply a "List Related" formula to list the genres related to a given movie, we can add and remove genres to that list, which will create/delete records in the appropriate underlying tables.
       - in the future, we may also support editing the genre names themselves.

# List of Formulas
This is a list of view formulas that we should support in the alpha release of Mathesar, categorized into types.

## Aggregations
These formulas are related to aggregating related items. We will support finding related items up to three levels of FKs deep.

All the formulas in this category take the same single variable:
- **Related Item**
     - **Description**: The column (and relationship to use) to aggregate.
     - **Type** Column reference of type "multiple related records" with any associated filters

### Count
- **Data Type**: Integer
- **Description**: Show a count of related items.
- **Data Editable?**: No

#### Example Query
```sql
select movie.title as title, count(actor.name) as num_actors
from movie 
inner join movie_actor_map on movie.id = movie_actor_map.movie_id
inner join actor on movie_actor_map.actor_id = actor.id
group by movie.title;
```

### List
- **Data Type**: List (list item data type depends on the data type of the column being summarized.
- **Description**: Show a list of related items.
- **Data Editable?**: Yes 

#### Editing behavior
Data generated using list formulas are editable in two ways:
- **Editing existing items** The user can always edit the contents of an existing item.
    - We are just editing the relevant record in the underlying table.
    - We should make it clear to the user that all instances of the data will be changed, not just in this record.
- **Adding and removing items to a list**: The user can add or remove items from the list. This is only true in the following circumstances:
    - the tables being used to generate the list (including intermediate tables) have no other required fields other than the one the user is editing.
    - we have enough information in the filters being used to generate the list to fill in any required fields other than the one the user is editing in the tables being used to generate the list (including intermediate tables) 

To illustrate editing behavior, let's consider the **Movie Actor** view in [Appendix A](/en/product/specs/2022-01-views/08-appendix). 

- **Editing existing items**:
    - The user can edit `Brad Pitt` in row 1 to say `William Bradley Pitt` instead.
- **Adding rows**:
    - The user can add `Geena Davis` to the `Meet Joe Black` movie (she's not in that movie but that's beside the point). This will add a new record in **Movie Person Map** to map the existing actor record for Geena Davis to the existing movie record movie record with a `Role` of `Actor` (since we know that from the filter that defines the column).
        - We need to be using autocomplete to select records here (with a record preview) so that the user can select the correct record in case there are two `Geena Davis` records.
        - If there was no filter defined on the column, we would leave the `Role` value blank.
    - The user can add `Anthony Hopkins` to `Meet Joe Black` and this will insert new records in both `Person` and `Movie Person Map` (again with a `Role` of `Actor`).
    
Although the illustration above uses a mapping table, it also applies to other forms of relationships.
    
#### Example Query
```sql
select movie.title as title, array_agg(actor.name) as actors
from movie 
inner join movie_actor_map on movie.id = movie_actor_map.movie_id
inner join actor on movie_actor_map.actor_id = actor.id
group by movie.title;
```

### Average
- **Data Type**: Same as the type being averaged
- **Variables Accepted**: Although this also accepts a **Related Item**, there is a further caveat that the column must be of a Number type.
- **Description**: Show an average of related items.
- **Data Editable?**: No

### Minimum
- **Data Type**: Same as the type being averaged
- **Variables Accepted**: Although this also accepts a **Related Item**, there is a further caveat that the column must be of a Number type.
- **Description**: Show the minimum value of all related items.
- **Data Editable?**: No

### Maximum
- **Data Type**: Same as the type being averaged
- **Variables Accepted**: Although this also accepts a **Related Item**, there is a further caveat that the column must be of a Number type.
- **Description**: Show the maximum value of all related items.
- **Data Editable?**: No
